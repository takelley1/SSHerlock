{% extends "home.html" %}
{% load custom_filters %}
{% block title %}{{ object_name }}{% endblock %}

{% block content %}

<div class="ml-10 mt-5">
<a href="{% url 'add_object' object_name.split|join:'_'|lower %}" class="button border-b-4 border-transparent hover:border-b-green-500">New {{ object_name }}</a>
</div>

{% if output %}

<div class="mx-10">
  <table id="object_list_table">
    <thead>
      <tr>
        {% for header in column_headers %}
        <th scope="col">{{ header }}</th>
        {% endfor %}

        {% if object_name != "Job" %}
        <th scope="col">Edit</th>
        <th scope="col">Delete</th>
        {% endif %}

        {% if object_name == "Job" %}
        <th scope="col">Retry</th>
        <th scope="col">View</th>
        {% endif %}

      </tr>
    </thead>
    <tbody>
      {% for item in output %}
        <tr>
          {% for field in object_fields %}
          <td>
            <div class="flex items-center">
              {% if object_name == "Job" %}
                {% with status=item|get_attr:field %}
                  {% if status %}
                    {% if status == 'Canceled' %}
                      <div class="w-3 h-3 bg-gray-300 rounded-full mr-2 flex-shrink-0"></div>
                    {% elif status == 'Completed' %}
                      <div class="w-3 h-3 bg-green-300 rounded-full mr-2 flex-shrink-0"></div>
                    {% elif status == 'Context exceeded' or status == 'Failed' %}
                      <div class="w-3 h-3 bg-red-500 rounded-full mr-2 flex-shrink-0"></div>
                    {% elif status == 'Pending' %}
                      <div class="w-3 h-3 bg-yellow-300 rounded-full mr-2 flex-shrink-0"></div>
                    {% elif status == 'Running' %}
                      <div class="w-3 h-3 bg-blue-300 rounded-full mr-2 flex-shrink-0"></div>
                    {% endif %}
                  {% endif %}
                {% endwith %}
              {% endif %}
              <span>{{ item|get_attr:field }}</span>
            </div>
          </td>
          {% endfor %}

          {# Jobs can't be edited or deleted, so don't show the edit button for them #}
          {% if object_name != "Job" %}
            <td><a href="{% url 'edit_object' object_name.split|join:'_'|lower item.id %}" class="button">edit</a></td>
            <td><a href="{% url 'delete_object' object_name.split|join:'_'|lower item.id %}" class="button">delete</a></td>
          {% endif %}

          {# Jobs get "retry" and "cancel" buttons. #}
          {% if object_name == "Job" %}
            <td><a href="{% url 'retry_job' item.id %}" class="button">retry</a></td>
            <td><a href="{% url 'view_job' item.id %}" class="button">view</a></td>
          {% endif %}

        </tr>
      {% endfor %}
    <tbody>
  </table>

</div>
{% else %}

  {% if object_name == "LLM API" %}
    <p>No {{ object_name }}s available</p>
  {% else %}
    <p>No {{ object_name | title}}s available</p>
  {% endif %}

{% endif %}

<!-- Use DataTable to prettify and format the table. -->
<script>
  $(document).ready( function () {
      $('#object_list_table').DataTable();
  } );
</script>

{% endblock %}
