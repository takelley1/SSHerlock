{% extends "home.html" %}
{% load custom_filters %}
{% block title %}Jobs{% endblock %}

{% block content %}

<div class="ml-10 mt-5">
<a href="{% url 'add_object' 'job' %}" class="button border-b-4 border-transparent hover:border-b-green-500">New Job</a>
</div>

{% if output %}

<div class="mx-10">
  <table id="job_list_table">
    <thead>
      <tr>
        {% for header in column_headers %}
        <th scope="col">{{ header }}</th>
        {% endfor %}
        <th scope="col">Controls</th>
      </tr>
    </thead>
    <tbody>
      {% for item in output %}
        <tr onclick="window.location='{% url 'view_job' item.id %}'" style="cursor: pointer;">
          {% for field in object_fields %}
          <td>
            <div class="flex items-center">
              {% with status=item|get_attr:field %}
                {% if status %}
                  {% if status == 'Canceled' %}
                    <div class="w-3 h-3 bg-gray-300 rounded-full mr-2 flex-shrink-0"></div>
                  {% elif status == 'Completed' %}
                    <div class="w-3 h-3 bg-green-300 rounded-full mr-2 flex-shrink-0"></div>
                  {% elif status == 'Context exceeded' or status == 'Failed' %}
                    <div class="w-3 h-3 bg-red-500 rounded-full mr-2 flex-shrink-0"></div>
                  {% elif status == 'Pending' %}
                    <div class="w-3 h-3 bg-yellow-300 rounded-full mr-2 flex-shrink-0"></div>
                  {% elif status == 'Running' %}
                    <div class="w-3 h-3 bg-blue-300 rounded-full mr-2 flex-shrink-0"></div>
                  {% endif %}
                {% endif %}
              <span>{{ item|get_attr:field }}</span>
            </div>
          </td>
          {% endwith %}
          {% endfor %}
          <td>
            <div class="flex space-x-2">
              {% if item.status == "Running" or item.status == "Pending" %}
                <form method="post" action="{% url 'cancel_job' job_id=item.id %}">
                  {% csrf_token %}
                  <button type="submit" class="border-red-500 border-2 rounded-lg p-1 hover:bg-red-200">Cancel</button>
                </form>
              {% endif %}
              {% if item.status == "Canceled" or item.status == "Failed" or item.status == "Context exceeded" %}
                <a class="border-gray-500 border-2 rounded-lg p-1 hover:bg-gray-200" href="{% url 'retry_job' item.id %}">Retry</a>
              {% endif %}
            </div>
          </td>
        </tr>
      {% endfor %}
    <tbody>
  </table>

</div>
{% else %}
  <p>No Jobs available</p>
{% endif %}

<!-- Use DataTable to prettify and format the table. -->
<script>
  $(document).ready( function () {
      $('#job_list_table').DataTable();
  } );
</script>

{% endblock %}
